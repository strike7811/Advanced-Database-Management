---Trigger : Track History on Customer
---purpose - To tracking data modifications with insert, update and delete statement.

SQL code:
SET SERVEROUTPUT ON;

COLUMN UserID FORMAT A6 TRUNCATE HEADING 'USERID';
COLUMN CustID FORMAT A6 HEADING 'CUSTID';
COLUMN CustName FORMAT A15 TRUNCATE HEADING 'CUSTNAME';
COLUMN CustNRIC FORMAT A12 HEADING 'CUSTNRIC';
COLUMN CustGender FORMAT A6 HEADING 'GENDER';
COLUMN CustPhone FORMAT A11 HEADING 'CUSTPHNNUM';
COLUMN Old_CustPhone FORMAT A11 HEADING 'OLDPHNNUM';
COLUMN New_CustPhone FORMAT A11 HEADING 'NEWPHNNUM';
COLUMN CustEmail FORMAT A25 TRUNCATE HEADING 'CUSTEMAILADDRESS';

DROP TABLE DELETECUSTOMER;
DROP TABLE UPDATECUSTOMER;
DROP TABLE INSERTCUSTOMER;

CREATE TABLE INSERTCUSTOMER (
  UserID            VARCHAR(8),
  Edit_Date         DATE,
  CustID            VARCHAR(5)  NOT NULL,
  CustName          VARCHAR(50) NOT NULL,
  CustNRIC          VARCHAR(12) NOT NULL,
  CustGender        VARCHAR(1)  NOT NULL CHECK(CustGender IN ('M','F')),
  CustPhone         VARCHAR(11) NOT NULL,
  CustEmail         VARCHAR(50) NOT NULL CHECK(CustEmail LIKE '_%@_%.com')
);

CREATE TABLE UPDATECUSTOMER (
  UserID            VARCHAR(8),
  Edit_Date         DATE,
  CustID            VARCHAR(5)  NOT NULL,
  CustName          VARCHAR(50) NOT NULL,
  CustNRIC          VARCHAR(12) NOT NULL,
  CustGender        VARCHAR(1)  NOT NULL CHECK(CustGender IN ('M','F')),
  Old_CustPhone     VARCHAR(11) NOT NULL,
  New_CustPhone     VARCHAR(11) NOT NULL,
  CustEmail         VARCHAR(50) NOT NULL CHECK(CustEmail LIKE '_%@_%.com')
);

CREATE TABLE DELETECUSTOMER (
  UserID            VARCHAR(8),
  Edit_Date         DATE,
  CustID            VARCHAR(5)  NOT NULL,
  CustName          VARCHAR(50) NOT NULL,
  CustNRIC          VARCHAR(12) NOT NULL,
  CustGender        VARCHAR(1)  NOT NULL CHECK(CustGender IN ('M','F')),
  CustPhone         VARCHAR(11) NOT NULL,
  CustEmail         VARCHAR(50) NOT NULL CHECK(CustEmail LIKE '_%@_%.com')
);

CREATE OR REPLACE TRIGGER trg_track_customer
AFTER INSERT OR UPDATE OR DELETE ON Customer
FOR EACH ROW
BEGIN
  CASE
    WHEN INSERTING THEN
      INSERT INTO INSERTCUSTOMER VALUES(USER, SYSDATE, :NEW.CustID, :NEW.CustName, :NEW.CustNRIC, :NEW.CustGender, :NEW.CustPhone, :NEW.CustEmail);
    WHEN UPDATING THEN
      INSERT INTO UPDATECUSTOMER VALUES(USER, SYSDATE, :OLD.CustID, :OLD.CustName, :OLD.CustNRIC, :OLD.CustGender, :OLD.CustPhone, :NEW.CustPhone, :OLD.CustEmail);
    WHEN DELETING THEN
      INSERT INTO DELETECUSTOMER VALUES(USER, SYSDATE, :OLD.CustID, :OLD.CustName, :OLD.CustNRIC, :OLD.CustGender, :OLD.CustPhone, :OLD.CustEmail);
  END CASE;
END;
/

INSERT INTO CUSTOMER VALUES('C0241', 'Chua Zi Lin', '031212092345', 'F', '0123456789', 'zilin@gmail.com');

UPDATE CUSTOMER
SET CustPhone = '0106662898'
WHERE CustID = 'C0241';

DELETE FROM CUSTOMER
WHERE CustID = 'C0241';


TTITLE LEFT 'INSERT'
SELECT * FROM INSERTCUSTOMER;

TTITLE LEFT 'UPDATE'
SELECT * FROM UPDATECUSTOMER;

TTITLE LEFT 'DELETE'
SELECT * FROM DELETECUSTOMER;

TTITLE OFF;
CLEAR COLUMNS;
